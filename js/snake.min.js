$(document).ready(function(){function t(){localStorage.getItem("length_snake")>40?(S=35,localStorage.setItem("length_snake",35)):S=localStorage.getItem("length_snake")||5}function e(){for(var t=document.getElementsByName("speed"),e=0;e<t.length;e++)"radio"==t[e].type&&t[e].checked&&(_=t[e].value)}function n(){t(),a(),l(),1==y&&r(S,S*x,0),o(),m="right","undefined"!=typeof game_loop&&clearInterval(game_loop),game_loop=setInterval(c,_)}function a(){k=[];for(var t=S-1;t>=0;t--)k.push({x:t,y:0})}function o(){d={x:Math.round(Math.random()*(h-x)/x),y:Math.round(Math.random()*(f-x)/x)}}function l(){document.getElementById("columns").checked&&(y=1)}function r(t,e,n){v=[],v[0]=parseInt(t/10,10);for(var a=1;a<=2*v[0];a++)v[a]=Math.round(Math.random()*(h-x)/x),v[a]=v[a]==e||v[a]==e-x||v[a]==e+x?v[a]+1:v[a],v[a+1]=Math.round(Math.random()*(f-x)/x),v[a+1]=v[a+1]==n||v[a+1]==n-x||v[a+1]==n+x?v[a+1]+1:v[a+1],a++}function c(){if(g.fillStyle="white",g.fillRect(0,0,h,f),p=k[0].x,I=k[0].y,"up"==m?I--:"left"==m?p--:"down"==m?I++:"right"==m&&p++,1==y)for(var t=1;t<=2*v[0];t++){if(p==v[t]&&I==v[t+1])return localStorage.setItem("length_snake",5),void n();t++}if(document.getElementById("field").checked){if(u(p,I,k))return localStorage.setItem("length_snake",5),void n();-1==p?p=h/x:p==h/x&&(p=0),-1==I?I=f/x:I==f/x&&(I=0)}else if(u(p,I,k)||-1==p||p==h/x||-1==I||I==f/x)return localStorage.setItem("length_snake",5),void n();if(p==d.x&&I==d.y){var e={x:p,y:I};S++,localStorage.setItem("length_snake",S),S>b&&(b=S,localStorage.setItem("max_length_snake",b)),r(S,d.x,d.y),o()}else{var e=k.pop();e.x=p,e.y=I}if(k.unshift(e),1==y)for(var t=1;t<=2*v[0];t++)i(v[t],v[t+1],"#ddd"),t++;for(var t=0;t<k.length;t++){var a=k[t];i(a.x,a.y,"#17B4ED")}i(d.x,d.y,"#17B4ED"),$(".status").html("<p>Длина змейки: "+S+"</p><p>Максимальная длина: "+b+"</p>")}function i(t,e,n){g.fillStyle=n,g.fillRect(t*x,e*x,x,x),g.strokeStyle="white",g.strokeRect(t*x,e*x,x,x)}function u(t,e,n){for(var a=0;a<n.length;a++)if(n[a].x==t&&n[a].y==e)return!0;return!1}FastClick.attach(document.body);var s=$("#canvas")[0],g=s.getContext("2d"),h=$("#canvas").width(),f=$("#canvas").height();void 0==localStorage.getItem("max_length_snake")&&localStorage.setItem("max_length_snake",5),void 0==localStorage.getItem("length_snake")&&localStorage.setItem("length_snake",5);var m,d,v,_,k,p,I,y,S,x=10,w=0,b=localStorage.getItem("max_length_snake")||5;t(),$(".status").html("<p>Длина змейки: "+S+"</p><p>Максимальная длина: "+b+"</p>");var M=document.getElementById("start_buttton");$("#start_buttton").click(function(){0==w?(e(),n(),M.setAttribute("value","Пауза"),w=1):1==w?(clearInterval(game_loop),M.setAttribute("value","Продолжить"),w=2):(e(),game_loop=setInterval(c,_),M.setAttribute("value","Пауза"),w=1)}),$("#restart_buttton").click(function(){localStorage.setItem("length_snake",5),e(),n(),M.setAttribute("value","Пауза"),w=1}),$(".clear_status_buttton").click(function(){localStorage.setItem("length_snake",5),localStorage.setItem("max_length_snake",5),S=5,b=5,M.setAttribute("value","Старт"),w=0,$(".status").html("<p>Длина змейки: 5</p><p>Максимальная длина: 5</p>")}),$(document).keydown(function(t){var e=t.which;"38"==e&&"down"!=m&&1==w?m="up":"37"==e&&"right"!=m&&1==w?m="left":"40"==e&&"up"!=m&&1==w?m="down":"39"==e&&"left"!=m&&1==w&&(m="right")}),$("#up").click(function(){"down"!=m&&1==w&&(m="up")}),$("#left").click(function(){"right"!=m&&1==w&&(m="left")}),$("#right").click(function(){"left"!=m&&1==w&&(m="right")}),$("#down").click(function(){"up"!=m&&1==w&&(m="down")}),$("#settings_buttton").click(function(){$(".settings").toggle("slow")})});